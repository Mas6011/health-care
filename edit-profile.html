<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile - SMK CERIA HEALTH CARE</title>
    <style>
        /* Modern App Styles */
        body {
            font-family: Arial, Helvetica, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
        }

        .edit-container {
            background-color: white;
            padding: 40px;
            width: 420px;
            border-radius: 20px;
            border: 2px solid #cbd5e1;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }

        .header-title {
            font-size: 18px;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 5px;
        }

        h2 {
            margin: 0 0 25px 0;
            font-size: 20px;
            color: #3b82f6;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #475569;
            font-size: 14px;
        }

        input {
            width: 100%;
            box-sizing: border-box;
            border: 1.5px solid #cbd5e1;
            border-radius: 10px;
            padding: 12px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: #3b82f6;
        }

        /* Styling for the file upload button */
        input[type="file"] {
            padding: 8px;
            background-color: #f8fafc;
            font-size: 12px;
        }

        hr {
            border: 0;
            border-top: 1.5px solid #e2e8f0;
            margin: 25px 0;
        }

        .button-container {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }

        button {
            flex: 1;
            border: none;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.1s, background-color 0.2s;
        }

        .btn-cancel {
            background-color: #94a3b8;
            color: white;
        }

        .btn-cancel:hover {
            background-color: #64748b;
        }

        .btn-save {
            background-color: #10b981;
            color: white;
        }

        .btn-save:hover {
            background-color: #059669;
        }

        button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>

    <div class="edit-container">
        <div class="header-title">SMK CERIA HEALTH CARE</div>
        <h2>Edit Profile Information</h2>
        
        <div class="input-group">
            <label>Student Name</label>
            <input type="text" id="edit-name" placeholder="Full Name">
        </div>

        <div class="input-group">
            <label>Student Class</label>
            <input type="text" id="edit-class" placeholder="e.g. 5A">
        </div>

        <div class="input-group">
            <label>Student Photo</label>
            <input type="file" id="edit-pic-student" accept="image/*">
        </div>

        <div class="input-group">
            <label>Medical History</label>
            <input type="text" id="edit-history" placeholder="Any past illnesses?">
        </div>

        <div class="input-group">
            <label>Allergy</label>
            <input type="text" id="edit-allergy" placeholder="Food or medicine allergies">
        </div>

        <hr>

        <div class="input-group">
            <label>Parent Name</label>
            <input type="text" id="edit-parent-name" placeholder="Guardian Name">
        </div>

        <div class="input-group">
            <label>Parent Phone Number</label>
            <input type="text" id="edit-parent-phone" placeholder="e.g. 012-3456789">
        </div>

        <div class="input-group">
            <label>Parent Photo</label>
            <input type="file" id="edit-pic-parent" accept="image/*">
        </div>
        
        <div class="button-container">
            <button class="btn-cancel" onclick="window.location.href='student-profile.html'">Cancel</button>
            <button class="btn-save" onclick="updateProfile()">Save Changes</button>
        </div>
    </div>

    <script>
        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        async function updateProfile() {
            // 1. Get the current list of students from localStorage
            let studentList = JSON.parse(localStorage.getItem('allStudents')) || [];

            // 2. Prepare the data for the current student
            const studentData = {
                name: document.getElementById('edit-name').value,
                class: document.getElementById('edit-class').value,
                history: document.getElementById('edit-history').value,
                allergy: document.getElementById('edit-allergy').value,
                parentName: document.getElementById('edit-parent-name').value,
                parentPhone: document.getElementById('edit-parent-phone').value,
                studentPic: "",
                parentPic: ""
            };

            // 3. Handle Images (Convert to Base64)
            const sFile = document.getElementById('edit-pic-student').files[0];
            if (sFile) studentData.studentPic = await toBase64(sFile);

            const pFile = document.getElementById('edit-pic-parent').files[0];
            if (pFile) studentData.parentPic = await toBase64(pFile);

            // 4. Update existing or Add new
            const index = studentList.findIndex(s => s.name.toLowerCase() === studentData.name.toLowerCase());
            if (index !== -1) {
                studentList[index] = studentData; // Update existing student
            } else {
                studentList.push(studentData); // Add new student to list
            }

            // 5. Save the whole list back and set this student as the "active" view
            localStorage.setItem('allStudents', JSON.stringify(studentList));
            localStorage.setItem('currentStudentName', studentData.name);

            alert("Data Saved Successfully!");
            window.location.href = 'student-profile.html';
        }

        window.onload = function() {
            const target = localStorage.getItem('currentStudentName');
            const list = JSON.parse(localStorage.getItem('allStudents')) || [];
            const student = list.find(s => s.name === target);

            if(student) {
                document.getElementById('edit-name').value = student.name;
                document.getElementById('edit-class').value = student.class;
                document.getElementById('edit-history').value = student.history;
                document.getElementById('edit-allergy').value = student.allergy;
                document.getElementById('edit-parent-name').value = student.parentName;
                document.getElementById('edit-parent-phone').value = student.parentPhone;
            }
        };
    </script>
</body>
</html>